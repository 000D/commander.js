<html><head><title>Commander.js - nodejs cli framework</title><link rel="stylesheet" href="style.css"/></head><body><div id="content"><h1>Commander.js</h1><p>Commander is a light-weight, expressive, and powerful command-line
framework for <a href="http://nodejs.org">node.js</a>.

</p><div id="exports.Command" class="comment"><h1>exports.Command</h1><div class="description"><p>Expose <code>Command</code>.</p></div><h2>Implementation</h2><pre><code>exports.Command = Command;</code></pre></div><div id="exports.Option" class="comment"><h1>exports.Option</h1><div class="description"><p>Expose <code>Option</code>.</p></div><h2>Implementation</h2><pre><code>exports.Option = Option;</code></pre></div><div id="Option" class="comment"><h1>Option()</h1><div class="description"><p>Initialize a new <code>Option</code> with the given <code>flags</code> and <code>description</code>.</p></div><h2>Implementation</h2><pre><code>function Option(flags, description) {
  this.flags = flags;
  this.required = ~flags.indexOf('<');
  this.optional = ~flags.indexOf('[');
  this.bool = !~flags.indexOf('-no-');
  flags = flags.split(/[ ,|]+/)
  this.short = flags.shift();
  this.long = flags.shift();
  this.description = description;
}</code></pre></div><div id="Option.prototype.name" class="comment"><h1>Option#name()</h1><div class="description"><p>Return option name.</p></div><h2>Implementation</h2><pre><code>Option.prototype.name = function(){
  return this.long
    .replace('--', '')
    .replace('no-', '');
};</code></pre></div><div id="Option.prototype.is" class="comment"><h1>Option#is()</h1><div class="description"><p>Check if <code>arg</code> matches the short or long flag.</p></div><h2>Implementation</h2><pre><code>Option.prototype.is = function(arg){
  return arg == this.short
    || arg == this.long;
};</code></pre></div><div id="Command" class="comment"><h1>Command()</h1><div class="description"><p>Initialize a new <code>Command</code>.</p></div><h2>Implementation</h2><pre><code>function Command(name) {
  this.commands = [];
  this.options = [];
  this.args = [];
  this.name = name;
}</code></pre></div><div id="Command.prototype__proto__" class="comment"><h1>Command.prototype__proto__</h1><div class="description"><p>Inherit from <code>EventEmitter.prototype</code>.</p></div><h2>Implementation</h2><pre><code>Command.prototype.__proto__ = EventEmitter.prototype;</code></pre></div><div id="Command.prototype.command" class="comment"><h1>Command#command()</h1><div class="description"><p>Add command <code>name</code>.</p>

<p>The <code>.action()</code> callback is invoked when the<br />command <code>name</code> is specified via <strong>ARGV</strong>,<br />and the remaining arguments are applied to the<br />function for access.</p>

<p>When the <code>name</code> is "*" an un-matched command<br />will be passed as the first arg, followed by<br />the rest of <strong>ARGV</strong> remaining.</p>

<h2>Examples</h2>

<pre><code> program
   .version('0.0.1')
   .option('-C, --chdir &lt;path&gt;', 'change the working directory')
   .option('-c, --config &lt;path&gt;', 'set config path. defaults to ./deploy.conf')
   .option('-T, --no-tests', 'ignore test hook')

 program
   .command('setup')
   .description('run remote setup commands')
   .action(function(){
     console.log('setup');
   });

 program
   .command('exec &lt;cmd&gt;')
   .description('run the given remote command')
   .action(function(cmd){
     console.log('exec "%s"', cmd);
   });

 program
   .command('*')
   .description('deploy the given env')
   .action(function(env){
     console.log('deploying "%s"', env);
   });

 program.parse(process.argv);
</code></pre></div><h2>Implementation</h2><pre><code>Command.prototype.command = function(name){
  var args = name.split(/ +/);
  var cmd = new Command(args.shift());
  this.commands.push(cmd);
  cmd.parseExpectedArgs(args);
  cmd.parent = this;
  return cmd;
};</code></pre></div><div id="Command.prototype.parseExpectedArgs" class="comment"><h1>Command#parseExpectedArgs()</h1><div class="description"><p>Parse expected <code>args</code>.</p>

<p>For example <code>["[type]"]</code> becomes <code>[{ required: false, name: 'type' }]</code>.</p></div><h2>Implementation</h2><pre><code>Command.prototype.parseExpectedArgs = function(args){
  if (!args.length) return;
  var self = this;
  args.forEach(function(arg){
    switch (arg[0]) {
      case '<':
        self.args.push({ required: true, name: arg.slice(1, -1) });
        break;
      case '[':
        self.args.push({ required: false, name: arg.slice(1, -1) });
        break;
    }
  });
  return this;
};</code></pre></div><div id="Command.prototype.action" class="comment"><h1>Command#action()</h1><div class="description"><p>Register callback <code>fn</code> for the command.</p>

<h2>Examples</h2>

<pre><code> program
   .command('help')
   .description('display verbose help')
   .action(function(){
      // output help here
   });
</code></pre></div><h2>Implementation</h2><pre><code>Command.prototype.action = function(fn){
  var self = this;
  this.parent.on(this.name, function(args){
    self.args.forEach(function(arg, i){
      if (arg.required && null == args[i]) {
        self.missingArgument(arg.name);
      }
    });
    fn.apply(this, args);
  });
  return this;
};</code></pre></div><div id="Command.prototype.option" class="comment"><h1>Command#option()</h1><div class="description"><p>Define option with <code>flags</code>, <code>description</code> and optional<br />coercion <code>fn</code>. </p>

<p>The <code>flags</code> string should contain both the short and long flags,<br />separated by comma, a pipe or space. The following are all valid<br />all will output this way when <code>--help</code> is used.</p>

<p>"-p, --pepper"<br />   "-p|--pepper"<br />   "-p --pepper"</p>

<h2>Examples</h2>

<pre><code>// simple boolean defaulting to false
program.option('-p, --pepper', 'add pepper');

--pepper
program.pepper
// =&gt; Boolean

// simple boolean defaulting to false
program.option('-C, --no-cheese', 'remove cheese');

program.cheese
// =&gt; true

--no-cheese
program.cheese
// =&gt; true

// required argument
program.option('-C, --chdir &lt;path&gt;', 'change the working directory');

--chdir /tmp
program.chdir
// =&gt; "/tmp"

// optional argument
program.option('-c, --cheese [type]', 'add cheese [marble]');
</code></pre></div><h2>Implementation</h2><pre><code>Command.prototype.option = function(flags, description, fn, defaultValue){
  var self = this
    , option = new Option(flags, description)
    , oname = option.name()
    , name = camelcase(oname);

  // default as 3rd arg
  if ('function' != typeof fn) defaultValue = fn, fn = null;

  // preassign default value only for --no-*, [optional], or <required>
  if (false == option.bool || option.optional || option.required) {
    // when --no-* we make sure default is true
    if (false == option.bool) defaultValue = true;
    // preassign only if we have a default
    if (undefined !== defaultValue) self[name] = defaultValue;
  }

  // register the option
  this.options.push(option);

  // when it's passed assign the value
  // and conditionally invoke the callback
  this.on(oname, function(val){
    // coercion
    if (null != val && fn) val = fn(val);

    // unassigned or bool
    if ('boolean' == typeof self[name] || 'undefined' == typeof self[name]) {
      // if no value, bool true, and we have a default, then use it!
      if (null == val) {
        self[name] = option.bool
          ? defaultValue || true
          : false;
      } else {
        self[name] = val;
      }
    } else if (null !== val) {
      // reassign
      self[name] = val;
    }
  });

  return this;
};</code></pre></div><div id="Command.prototype.parse" class="comment"><h1>Command#parse()</h1><div class="description"><p>Parse <code>argv</code>, settings options and invoking commands when defined.</p></div><h2>Implementation</h2><pre><code>Command.prototype.parse = function(argv){
  // store raw args
  this.rawArgs = argv;

  // guess name
  if (!this.name) this.name = basename(argv[1]);

  // process argv
  this.args = this.parseOptions(this.normalize(argv));
  return this.parseArgs(this.args);
};</code></pre></div><div id="Command.prototype.normalize" class="comment"><h1>Command#normalize()</h1><div class="description"><p>Normalize <code>args</code>, splitting joined short flags. For example<br />the arg "-abc" is equivalent to "-a -b -c".</p></div><h2>Implementation</h2><pre><code>Command.prototype.normalize = function(args){
  var ret = []
    , arg;

  for (var i = 0, len = args.length; i < len; ++i) {
    arg = args[i];
    if (arg.length > 1 && '-' == arg[0] && '-' != arg[1]) {
      arg.slice(1).split('').forEach(function(c){
        ret.push('-' + c);
      });
    } else {
      ret.push(arg);
    }
  }

  return ret;
};</code></pre></div><div id="Command.prototype.parseArgs" class="comment"><h1>Command#parseArgs()</h1><div class="description"><p>Parse command <code>args</code>.</p>

<p>When listener(s) are available those<br />callbacks are invoked, otherwise the "*"<br />event is emitted and those actions are invoked.</p></div><h2>Implementation</h2><pre><code>Command.prototype.parseArgs = function(args){
  var cmds = this.commands
    , len = cmds.length
    , name;

  if (args.length) {
    name = args[0];
    if (this.listeners(name).length) {
      this.emit(args.shift(), args);
    } else {
      this.emit('*', args);
    }
  }

  return this;
};</code></pre></div><div id="Command.prototype.optionFor" class="comment"><h1>Command#optionFor()</h1><div class="description"><p>Return an option matching <code>arg</code> if any.</p></div><h2>Implementation</h2><pre><code>Command.prototype.optionFor = function(arg){
  for (var i = 0, len = this.options.length; i < len; ++i) {
    if (this.options[i].is(arg)) {
      return this.options[i];
    }
  }
};</code></pre></div><div id="Command.prototype.parseOptions" class="comment"><h1>Command#parseOptions()</h1><div class="description"><p>Parse options from <code>argv</code> returning <code>argv</code><br />void of these options.</p></div><h2>Implementation</h2><pre><code>Command.prototype.parseOptions = function(argv){
  var args = []
    , argv = argv.slice(2)
    , len = argv.length
    , option
    , arg;

  // parse options
  for (var i = 0; i < len; ++i) {
    arg = argv[i];
    option = this.optionFor(arg);

    // option is defined
    if (option) {
      // requires arg
      if (option.required) {
        arg = argv[++i];
        if (null == arg) return this.optionMissingArgument(option);
        if ('-' == arg[0]) return this.optionMissingArgument(option, arg);
        this.emit(option.name(), arg);
      // optional arg
      } else if (option.optional) {
        arg = argv[i+1];
        if (null == arg || '-' == arg[0]) {
          arg = null;
        } else {
          ++i;
        }
        this.emit(option.name(), arg);
      // bool
      } else {
        this.emit(option.name());
      }
      continue;
    }
    
    // looks like an option
    if (arg.length > 1 && '-' == arg[0]) {
      this.unknownOption(arg);
    }
    
    // arg
    args.push(arg);
  }

  return args;
};</code></pre></div><div id="Command.prototype.missingArgument" class="comment"><h1>Command#missingArgument()</h1><div class="description"><p>Argument <code>name</code> is missing.</p></div><h2>Implementation</h2><pre><code>Command.prototype.missingArgument = function(name){
  console.error();
  console.error("  error: missing required argument `%s'", name);
  console.error();
  process.exit(1);
};</code></pre></div><div id="Command.prototype.optionMissingArgument" class="comment"><h1>Command#optionMissingArgument()</h1><div class="description"><p><code>Option</code> is missing an argument, but received <code>flag</code> or nothing.</p></div><h2>Implementation</h2><pre><code>Command.prototype.optionMissingArgument = function(option, flag){
  console.error();
  if (flag) {
    console.error("  error: option `%s' argument missing, got `%s'", option.flags, flag);
  } else {
    console.error("  error: option `%s' argument missing", option.flags);
  }
  console.error();
  process.exit(1);
};</code></pre></div><div id="Command.prototype.unknownOption" class="comment"><h1>Command#unknownOption()</h1><div class="description"><p>Unknown option <code>flag</code>.</p></div><h2>Implementation</h2><pre><code>Command.prototype.unknownOption = function(flag){
  console.error();
  console.error("  error: unknown option `%s'", flag);
  console.error();
  process.exit(1);
};</code></pre></div><div id="Command.prototype.description" class="comment"><h1>Command#description()</h1><div class="description"><p>Set the description <code>str</code>.</p></div><h2>Implementation</h2><pre><code>Command.prototype.description = function(str){
  if (0 == arguments.length) return this._description;
  this._description = str;
  return this;
};</code></pre></div><div id="Command.prototype.usage" class="comment"><h1>Command#usage()</h1><div class="description"><p>Set / get the command usage <code>str</code>.</p></div><h2>Implementation</h2><pre><code>Command.prototype.usage = function(str){
  var usage = '[options'
    + (this.commands.length ? '] [command' : '')
    + ']';
  if (0 == arguments.length) return this._usage || usage;
  this._usage = str;
  return this;
};</code></pre></div><div id="Command.prototype.largestOptionLength" class="comment"><h1>Command#largestOptionLength()</h1><div class="description"><p>Return the largest option length.</p></div><h2>Implementation</h2><pre><code>Command.prototype.largestOptionLength = function(){
  return this.options.reduce(function(max, option){
    return Math.max(max, option.flags.length);
  }, 0);
};</code></pre></div><div id="Command.prototype.optionHelp" class="comment"><h1>Command#optionHelp()</h1><div class="description"><p>Return help for options.</p></div><h2>Implementation</h2><pre><code>Command.prototype.optionHelp = function(){
  var width = this.largestOptionLength();
  return this.options.map(function(option){
    return pad(option.flags, width)
      + '  ' + option.description;
  }).join('\n');
};</code></pre></div><div id="Command.prototype.commandHelp" class="comment"><h1>Command#commandHelp()</h1><div class="description"><p>Return command help documentation.</p></div><h2>Implementation</h2><pre><code>Command.prototype.commandHelp = function(){
  if (!this.commands.length) return '';
  return [
      ''
    , '  Commands:'
    , ''
    , this.commands.map(function(cmd){
      var args = cmd.args.map(function(arg){
        return arg.required
          ? '<' + arg.name + '>'
          : '[' + arg.name + ']';
      }).join(' ');
      return cmd.name + ' ' + args
        + (cmd.description()
          ? '\n' + cmd.description()
          : '');
    }).join('\n\n').replace(/^/gm, '    ')
    , ''
  ].join('\n');
};</code></pre></div><div id="Command.prototype.helpInformation" class="comment"><h1>Command#helpInformation()</h1><div class="description"><p>Return program help documentation.</p></div><h2>Implementation</h2><pre><code>Command.prototype.helpInformation = function(){
  return [
      ''
    , '  Usage: ' + this.name + ' ' + this.usage()
    , '' + this.commandHelp()
    , '  Options:'
    , ''
    , '' + this.optionHelp().replace(/^/gm, '    ')
    , ''
    , ''
  ].join('\n');
};</code></pre></div><div id="Command.prototype.promptForNumber" class="comment"><h1>Command#promptForNumber()</h1><div class="description"><p>Prompt for a <code>Number</code>.</p></div><h2>Implementation</h2><pre><code>Command.prototype.promptForNumber = function(str, fn){
  this.promptSingleLine(str, function(val){
    val = Number(val);
    if (isNaN(val)) return program.promptForNumber(str + '(must be a number) ', fn);
    fn(val);
  });
};</code></pre></div><div id="Command.prototype.promptForDate" class="comment"><h1>Command#promptForDate()</h1><div class="description"><p>Prompt for a <code>Date</code>.</p></div><h2>Implementation</h2><pre><code>Command.prototype.promptForDate = function(str, fn){
  this.promptSingleLine(str, function(val){
    val = new Date(val);
    if (isNaN(val.getTime())) return program.promptForDate(str + '(must be a date) ', fn);
    fn(val);
  });
};</code></pre></div><div id="Command.prototype.promptSingleLine" class="comment"><h1>Command#promptSingleLine()</h1><div class="description"><p>Single-line prompt.</p></div><h2>Implementation</h2><pre><code>Command.prototype.promptSingleLine = function(str, fn){
  if ('function' == typeof arguments[2]) {
    return this['promptFor' + (fn.name || fn)](str, arguments[2]);
  }

  process.stdout.write(str);
  process.stdin.setEncoding('utf8');
  process.stdin.once('data', function(val){
    fn(val);
  }).resume();
};</code></pre></div><div id="Command.prototype.promptMultiLine" class="comment"><h1>Command#promptMultiLine()</h1><div class="description"><p>Multi-line prompt.</p></div><h2>Implementation</h2><pre><code>Command.prototype.promptMultiLine = function(str, fn){
  var buf = '';
  console.log(str);
  process.stdin.setEncoding('utf8');
  process.stdin.on('data', function(val){
    if ('\n' == val) {
      process.stdin.removeAllListeners('data');
      fn(buf);
    } else {
      buf += val;
    }
  }).resume();
};</code></pre></div><div id="Command.prototype.prompt" class="comment"><h1>Command#prompt()</h1><div class="description"><p>Prompt <code>str</code> and callback <code>fn(val)</code></p>

<p>Commander supports single-line and multi-line prompts.<br />To issue a single-line prompt simply add white-space<br />to the end of <code>str</code>, something like "name: ", whereas<br />for a multi-line prompt omit this "description:".</p>

<h2>Examples</h2>

<pre><code>program.prompt('Username: ', function(name){
  console.log('hi %s', name);
});

program.prompt('Description:', function(desc){
  console.log('description was "%s"', desc.trim());
});
</code></pre></div><h2>Implementation</h2><pre><code>Command.prototype.prompt = function(str, fn){
  if (/ $/.test(str)) return this.promptSingleLine.apply(this, arguments);
  this.promptMultiLine(str, fn);
};</code></pre></div><div id="Command.prototype.password" class="comment"><h1>Command#password()</h1><div class="description"><p>Prompt for password with <code>str</code>, <code>mask</code> char and callback <code>fn(val)</code>.</p>

<p>The mask string defaults to '', aka no output is<br />written while typing, you may want to use "*" etc.</p>

<h2>Examples</h2>

<pre><code>program.password('Password: ', function(pass){
  console.log('got "%s"', pass);
  process.stdin.destroy();
});

program.password('Password: ', '*', function(pass){
  console.log('got "%s"', pass);
  process.stdin.destroy();
});
</code></pre></div><h2>Implementation</h2><pre><code>Command.prototype.password = function(str, mask, fn){
  var self = this
    , buf = '';

  // default mask
  if ('function' == typeof mask) {
    fn = mask;
    mask = '';
  }

  tty.setRawMode(true);
  process.stdout.write(str);

  // keypress
  process.stdin.on('keypress', function(c, key){
    if (key && 'enter' == key.name) {
      console.log();
      process.stdin.removeAllListeners('keypress');
      tty.setRawMode(false);
      if (!buf.trim().length) return self.password(str, mask, fn);
      fn(buf);
      return;
    }

    if (key && key.ctrl && 'c' == key.name) {
      console.log('%s', buf);
      process.exit();
    }

    process.stdout.write(mask);
    buf += c;
  }).resume();
};</code></pre></div><div id="Command.prototype.confirm" class="comment"><h1>Command#confirm()</h1><div class="description"><p>Confirmation prompt with <code>str</code> and callback <code>fn(bool)</code></p>

<h2>Examples</h2>

<pre><code> program.confirm('continue? ', function(ok){
   console.log(' got %j', ok);
   process.stdin.destroy();
 });
</code></pre></div><h2>Implementation</h2><pre><code>Command.prototype.confirm = function(str, fn){
  var self = this;
  this.prompt(str, function(ok){
    if (!ok.trim()) {
      return self.confirm(str, fn);
    }
    fn(parseBool(ok));
  });
};</code></pre></div><div id="Command.prototype.choose" class="comment"><h1>Command#choose()</h1><div class="description"><p>Choice prompt with <code>list</code> of items and callback <code>fn(index, item)</code></p>

<h2>Examples</h2>

<pre><code> var list = ['tobi', 'loki', 'jane', 'manny', 'luna'];

 console.log('Choose the coolest pet:');
 program.choose(list, function(i){
   console.log('you chose %d "%s"', i, list[i]);
   process.stdin.destroy();
 });
</code></pre></div><h2>Implementation</h2><pre><code>Command.prototype.choose = function(list, fn){
  var self = this;

  list.forEach(function(item, i){
    console.log('  %d) %s', i + 1, item);
  });

  function again() {
    self.prompt('  : ', function(val){
      val = parseInt(val, 10) - 1;
      if (null == list[val]) {
        again();
      } else {
        fn(val, list[val]);
      }
    });
  }

  again();
};</code></pre></div><div id="camelcase" class="comment"><h1>camelcase()</h1><div class="description"><p>Camel-case the given <code>flag</code></p></div><h2>Implementation</h2><pre><code>function camelcase(flag) {
  return flag.split('-').reduce(function(str, word){
    return str + word[0].toUpperCase() + word.slice(1);
  });
}</code></pre></div><div id="parseBool" class="comment"><h1>parseBool()</h1><div class="description"><p>Parse a boolean <code>str</code>.</p></div><h2>Implementation</h2><pre><code>function parseBool(str) {
  return /^y|yes|ok|true$/i.test(str);
}</code></pre></div><div id="pad" class="comment"><h1>pad()</h1><div class="description"><p>Pad <code>str</code> to <code>width</code>.</p></div><h2>Implementation</h2><pre><code>function pad(str, width) {
  var len = Math.max(0, width - str.length);
  return str + Array(len + 1).join(' ');
}</code></pre></div></div><ul id="menu"><li><a href="#exports.Command">exports.Command</a></li><li><a href="#exports.Option">exports.Option</a></li><li><a href="#Option">Option()</a></li><li><a href="#Option.prototype.name">Option#name()</a></li><li><a href="#Option.prototype.is">Option#is()</a></li><li><a href="#Command">Command()</a></li><li><a href="#Command.prototype__proto__">Command.prototype__proto__</a></li><li><a href="#Command.prototype.command">Command#command()</a></li><li><a href="#Command.prototype.parseExpectedArgs">Command#parseExpectedArgs()</a></li><li><a href="#Command.prototype.action">Command#action()</a></li><li><a href="#Command.prototype.option">Command#option()</a></li><li><a href="#Command.prototype.parse">Command#parse()</a></li><li><a href="#Command.prototype.normalize">Command#normalize()</a></li><li><a href="#Command.prototype.parseArgs">Command#parseArgs()</a></li><li><a href="#Command.prototype.optionFor">Command#optionFor()</a></li><li><a href="#Command.prototype.parseOptions">Command#parseOptions()</a></li><li><a href="#Command.prototype.missingArgument">Command#missingArgument()</a></li><li><a href="#Command.prototype.optionMissingArgument">Command#optionMissingArgument()</a></li><li><a href="#Command.prototype.unknownOption">Command#unknownOption()</a></li><li><a href="#Command.prototype.description">Command#description()</a></li><li><a href="#Command.prototype.usage">Command#usage()</a></li><li><a href="#Command.prototype.largestOptionLength">Command#largestOptionLength()</a></li><li><a href="#Command.prototype.optionHelp">Command#optionHelp()</a></li><li><a href="#Command.prototype.commandHelp">Command#commandHelp()</a></li><li><a href="#Command.prototype.helpInformation">Command#helpInformation()</a></li><li><a href="#Command.prototype.promptForNumber">Command#promptForNumber()</a></li><li><a href="#Command.prototype.promptForDate">Command#promptForDate()</a></li><li><a href="#Command.prototype.promptSingleLine">Command#promptSingleLine()</a></li><li><a href="#Command.prototype.promptMultiLine">Command#promptMultiLine()</a></li><li><a href="#Command.prototype.prompt">Command#prompt()</a></li><li><a href="#Command.prototype.password">Command#password()</a></li><li><a href="#Command.prototype.confirm">Command#confirm()</a></li><li><a href="#Command.prototype.choose">Command#choose()</a></li><li><a href="#camelcase">camelcase()</a></li><li><a href="#parseBool">parseBool()</a></li><li><a href="#pad">pad()</a></li></ul></body></html>